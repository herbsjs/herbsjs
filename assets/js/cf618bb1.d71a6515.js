"use strict";(self.webpackChunkherbjs_website=self.webpackChunkherbjs_website||[]).push([[9127],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=a.createContext({}),l=function(e){var t=a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(u.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,u=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),d=l(n),m=r,k=d["".concat(u,".").concat(m)]||d[m]||c[m]||s;return n?a.createElement(k,i(i({ref:t},p),{},{components:n})):a.createElement(k,i({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,i=new Array(s);i[0]=d;var o={};for(var u in t)hasOwnProperty.call(t,u)&&(o[u]=t[u]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var l=2;l<s;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},89928:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>c,frontMatter:()=>s,metadata:()=>o,toc:()=>l});var a=n(87462),r=(n(67294),n(3905));const s={id:"features",title:"Usecase Features",sidebar_label:"Features",slug:"/usecase/features"},i=void 0,o={unversionedId:"usecase/features",id:"usecase/features",title:"Usecase Features",description:"Creating a Use Case",source:"@site/docs/usecase/features.md",sourceDirName:"usecase",slug:"/usecase/features",permalink:"/docs/usecase/features",draft:!1,editUrl:"https://github.com/herbsjs/herbsjs.github.io/blob/master/docs/usecase/features.md",tags:[],version:"current",frontMatter:{id:"features",title:"Usecase Features",sidebar_label:"Features",slug:"/usecase/features"},sidebar:"sidebar",previous:{title:"Getting Started",permalink:"/docs/usecase/getting-started"},next:{title:"Steps",permalink:"/docs/usecase/steps"}},u={},l=[{value:"Creating a Use Case",id:"creating-a-use-case",level:2},{value:"Authorizing and Running",id:"authorizing-and-running",level:2},{value:"Request",id:"request",level:2},{value:"Request From",id:"request-from",level:3},{value:"Response",id:"response",level:2},{value:"Request and Response Types",id:"request-and-response-types",level:2},{value:"Setup",id:"setup",level:2},{value:"Authorize",id:"authorize",level:2},{value:"Context (ctx)",id:"context-ctx",level:2},{value:"Audit",id:"audit",level:2},{value:"Metadata",id:"metadata",level:2}],p={toc:l};function c(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"creating-a-use-case"},"Creating a Use Case"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"usecase(description, body)"),", where:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"description"),": use case description, capturing the use case intent.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"body"),": object containing the use case structure: request, response, setup, authorize and steps.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"return: a Herbs use case instance."))),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const { Ok, Err, usecase, step, ifElse } = require('@herbsjs/herbs')\nconst createItem = usecase('Create Item', {\n    ...\n})\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Good descriptions:")),(0,r.kt)("p",null,"\u2705 Update User"),(0,r.kt)("p",null,"\u2705 Reopen Ticket"),(0,r.kt)("p",null,"\u2705 Request Report Generation"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Bad descriptions:")),(0,r.kt)("p",null,"\u274c updateUsers"),(0,r.kt)("p",null,"\u274c Report Gen"),(0,r.kt)("h2",{id:"authorizing-and-running"},"Authorizing and Running"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Authorizing")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},".authorize(user)"),", where:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"user"),": string or object containing a user payload.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"return: ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," for authorized or ",(0,r.kt)("inlineCode",{parentName:"p"},"false")," for unauthorized."))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Running")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},".run(request)"),", where:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"request"),": object containing the request values.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"return: a result with an Ok or an Err."))),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const usecase = createProduct()\n\nconst hasAccess = await usecase.authorize(req.user)\nif (!hasAccess) {\n    ...\n    throw new ForbiddenError()\n}\n\nconst request = { name: 'The best product' }\nconst response = await usecase.run(request)\n")),(0,r.kt)("h2",{id:"request"},"Request"),(0,r.kt)("p",null,"First, a use case must define the request fields and its types. This information is used as metadata for Glues. It is also used to validate request payload before running the use case."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"{ request: fields }"),", where:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"fields"),": object containing field names and types.")),(0,r.kt)("p",null,"During the use case execution it is possible to read the request value using ",(0,r.kt)("inlineCode",{parentName:"p"},"ctx.req"),"."),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const updateItem = (injection) =>\n\n    usecase('Update Item', {\n        // Input/Request type validation\n        request: {\n            id: Number,\n            description: String,\n            isDone: Boolean,\n            position: Number\n        }\n\n        'Retrieve the previous Item from the repository': step(async (ctx) => {\n            const req = ctx.req // request values\n            const ret = await repo.findByID(req.id)\n            ...\n        }),\n")),(0,r.kt)("p",null,"As a validation example, when it's executed with an ",(0,r.kt)("inlineCode",{parentName:"p"},"id"),", that is a string, the above use case return is:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const request = { id: '1' }\nconst ret = await usecase.run(request)\n\n// ret.err\n// { request: [{ id :[{ wrongType: \"Number\" }] }] }\n")),(0,r.kt)("h3",{id:"request-from"},"Request From"),(0,r.kt)("p",null,"Requests can be generated from an entity through ",(0,r.kt)("inlineCode",{parentName:"p"},"request.from(entity, settings)"),", where:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"entity"),": an entity"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"settings"),": object containing the following settings:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ignoreIDs"),": bool indicating to remove ID from generated schema"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ignore"),": array containing fields to be removed from generated schema")))),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const Item = entity('Item',{\n    id: id(Number),\n    description: field(String),\n    createdAt: field(Date)\n})\n\nconst createItem = (injection) =>\n    usecase('Create Item', {\n        request: request.from(Item, { ignoreIDs: true, ignore: ['createdAt'] })\n        // request: { description: String }\n")),(0,r.kt)("h2",{id:"response"},"Response"),(0,r.kt)("p",null,"It is possible to define the response type as well. This information is used as metadata for glues but it is not validated when running the use case."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"{ response: type }"),", where:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"type"),": response type.")),(0,r.kt)("p",null,"A use case will run all the steps sequencially or until one of the steps return a ",(0,r.kt)("inlineCode",{parentName:"p"},"Err"),". The ",(0,r.kt)("a",{parentName:"p",href:"/docs/usecase/result"},"result")," of a use case is set by the result of the last step executed."),(0,r.kt)("p",null,"The result value of a use case is set by ",(0,r.kt)("inlineCode",{parentName:"p"},"ctx.ret"),". It is possible to set this variable any time at any step."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const createProduct = injection =>\n    usecase('Create Product', {\n\n        request: {\n            name: String,\n            ...\n        },\n\n        response: {\n            product: Product\n        },\n\n        'Check if the Product is valid': step(ctx => {\n            ...\n            if (!isValid) return Err(errors) // it stops the execution here and return a Err\n            return Ok() // go to the next step\n        }),\n\n        'Save the Product on the repository': step(async ctx => {\n            ...\n            ctx.ret.product = await repo.insert(product) // set the return value\n            return Ok() // last step and return Ok\n        }),\n")),(0,r.kt)("h2",{id:"request-and-response-types"},"Request and Response Types"),(0,r.kt)("p",null,"A field in a request or the response can be basic types from Javascript or entities:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Number"),": double-precision 64-bit binary format IEEE 754 value"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"String"),": a UTF\u201016 character sequence"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Boolean"),": true or false"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Date"),": represents a single moment in time in a platform-independent format."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Object"),": the Object class represents one of JavaScript's data types."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Array"),": the Array class is a object that is used in the construction of arrays."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Entity"),": entity object represents an gotu base entity."),(0,r.kt)("p",null,"For array of a certain type use: ",(0,r.kt)("inlineCode",{parentName:"p"},"[type]"),". Ex: ",(0,r.kt)("inlineCode",{parentName:"p"},"id: [Number]")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"items: [Item]"),"."),(0,r.kt)("p",null,"The validation will not validatate for presence, so ",(0,r.kt)("inlineCode",{parentName:"p"},"null")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"undefined")," are accepted as valid values."),(0,r.kt)("h2",{id:"setup"},"Setup"),(0,r.kt)("p",null,"Like a constructor, it is the first function to be executed before ",(0,r.kt)("inlineCode",{parentName:"p"},"authorize")," and steps. Can be used to setup the dependency injection, for instance."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"{ setup: ctx => {} }"),", where:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ctx"),": execution context - internal object visible throughout the use case and steps execution")),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const addOrUpdateItem = (injection) =>\n\n    usecase('Add or Update an Item on a to-do List', {\n\n        // Pre-run setup\n        setup: ctx => (ctx.di = Object.assign({}, dependency, injection)),\n    ...\n")),(0,r.kt)("h2",{id:"authorize"},"Authorize"),(0,r.kt)("p",null,"A function executed before any steps to make sure the user is authorized to run the use case."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"{ authorize: async (user) => {} }"),", where:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"user"),": an object containing the user's information - this information will be audited.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"return: must return ",(0,r.kt)("inlineCode",{parentName:"p"},"Ok")," for authorized and ",(0,r.kt)("inlineCode",{parentName:"p"},"Err")," for unauthorized."))),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const addOrUpdateItem = (injection) =>\n\n    usecase('Add or Update an Item on a to-do List', {\n\n        // Authorization with Audit\n        authorize: async (user) => (user.canAddOrUpdateList ? Ok() : Err()),\n    ...\n")),(0,r.kt)("h2",{id:"context-ctx"},"Context (ctx)"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"ctx")," variable is used to access (read and write) the state of the use case and its steps during its execution."),(0,r.kt)("p",null,"For more details about context, check step context."),(0,r.kt)("h2",{id:"audit"},"Audit"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"usecase.auditTrail"),": Retrieve the audit trail of a use case after its execution."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const request = { name: 'The best product' }\nconst response = await createProduct.run(request)\nconsole.log(createProduct.auditTrail)\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},'process.env.HERBS_EXCEPTION = "audit"'),": Recommended for ",(0,r.kt)("strong",{parentName:"p"},"production environments")," - Swallow and audit exceptions thrown during the use case execution. This will swallow the exceptions and return a Err on the step. If ",(0,r.kt)("inlineCode",{parentName:"p"},"process.env.HERBS_EXCEPTION")," is not equal ",(0,r.kt)("inlineCode",{parentName:"p"},"audit")," any exceptions thrown during a use case execution will be thrown."),(0,r.kt)("p",null,"Result sample:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"{\n    // object type\n    type: 'use case',\n\n    // use case description\n    description: 'Add or Update an Item on a to-do List',\n\n    // unique Id for each use case execution\n    transactionId: '9985fb70-f56d-466a-b466-e200d1d4848c',\n\n    // total use case execution time in nanosecods\n    elapsedTime: 1981800n,\n\n    // the same user (object) provided on `usecase.authorize(user)`\n    user: { name: 'John', id: '923b8b9a', isAdmin: true },\n\n    // `usecase.authorize(user)` return\n    authorized: true,\n\n    // use case request\n    request: { name: 'The best product' },\n\n    // use case result\n    return: {\n        Ok: { item: { id: 100, name: 'Do not forget this', position: 9 } }\n    },\n\n    // steps\n    steps: [\n        {\n            // object type\n            type: 'step',\n\n            // use ase description\n            description: 'Check if the Item is valid',\n\n            // total step execution time in nanosecods\n            elapsedTime: 208201n ,\n\n            // step result\n            return: {}\n        },\n        ...\n    ]\n}\n")),(0,r.kt)("h2",{id:"metadata"},"Metadata"),(0,r.kt)("p",null,"To access the metadata of a use case: ",(0,r.kt)("inlineCode",{parentName:"p"},"uc.doc()")),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const createProduct = injection =>\n    usecase(\'Create Product\', {\n\n        request: {\n            description: String,\n        },\n\n        response: {\n            product: Product,\n        },\n\n        \'Check if the Product is valid\': step({\n\n            \'Validate Product origin\': step(ctx => {\n                return Ok()\n            }),\n\n            \'Validate Product information\': step(ctx => {\n                return Ok()\n            }),\n        }),\n    })\n\nconst uc = createProduct()\n\nconsole.log(uc.doc())\n// {\n//     type: "use case",\n//     description: "Create Product",\n//     request: {\n//         description: String\n//     },\n//     response: {\n//         product: Product\n//     },\n//     steps: [{\n//         type: "step",\n//         description: "Check if the Product is valid",\n//         steps: [{\n//             type: "step",\n//             description: "Validate Product origin",\n//             steps: null\n//         }, {\n//             type: "step",\n//             description: "Validate Product information",\n//             steps: null\n//         }]\n//     }]\n// }\n')))}c.isMDXComponent=!0}}]);